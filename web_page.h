String html_page = String("<!DOCTYPE html><html lang=\"zh-cn\"><head><meta charset=\"utf-8\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\"/>")
              + String("<title>") + String(WifiPrefix + String(ESP.getChipId())) + String(" - ") + String(ACCESSORY_NAME) + String("</title>")
              + String("<style type=\"text/css\">")
              + String("body{font-family:-apple-system,BlinkMacSystemFont,'Microsoft YaHei',sans-serif;font-size:16px;color:#333;line-height:1.75}#body{margin:0 auto;}@media screen and (max-width:900px){#body{width:98%}}#nav{text-align:center}#tab > div{display:none;margin:0 auto;max-width:600px}#nav button{background:#eee;border:1px solid #ddd;padding:.7em 1em;cursor:pointer;z-index:1;margin-left:-1px;outline:0;line-height:17px}#nav .active{background:#fff}table.gridtable{color:#333;border-width:1px;border-color:#ddd;border-collapse:collapse;margin:auto;margin-top:15px;width:100%}table.gridtable th{border-width:1.5px;padding:8px;border-style:solid;border-color:#ddd;background-color:#f5f5f5}table.gridtable td{border-width:1px;padding:8px;border-style:solid;border-color:#ddd;background-color:#fff}input,select{border:1px solid #ccc;padding:7px 0;border-radius:3px;padding-left:5px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}input:focus,select:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}#tab button{color:#fff;border-width:0;border-radius:3px;cursor:pointer;outline:0;font-size:17px;line-height:2.4rem;width:100%}#tab button[disabled]{cursor:not-allowed;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none;opacity:.65}.btn-info{background-color:#5bc0de;border-color:#46b8da}.btn-info:hover{background-color:#31b0d5;border-color:#269abc}.btn-success{background-color:#5cb85c;border-color:#4cae4c}.btn-success:hover{background-color:#449d44;border-color:#398439}.btn-danger{background-color:#d9534f;border-color:#d43f3a}.btn-danger:hover{background-color:#c9302c;border-color:#ac2925}.alert{width:80%;padding:15px;border:1px solid transparent;border-radius:4px;position:fixed;top:10px;left:10%;z-index:999999;display:none}label.bui-radios-label input{position:absolute;opacity:0;visibility:hidden}label.bui-radios-label .bui-radios{display:inline-block;position:relative;width:13px;height:13px;background:#fff;border:1px solid #979797;border-radius:50%;vertical-align:-2px}label.bui-radios-label input:checked + .bui-radios:after{position:absolute;content:'';width:7px;height:7px;background-color:#fff;border-radius:50%;top:3px;left:3px}label.bui-radios-label input:checked + .bui-radios{background:#00b066;border:1px solid #00b066}label.bui-radios-label input:disabled + .bui-radios{background-color:#e8e8e8;border:solid 1px #979797}label.bui-radios-label input:disabled:checked + .bui-radios:after{background-color:#c1c1c1}label.bui-radios-label .bui-radios{-webkit-transition:background-color ease-out .3s;transition:background-color ease-out .3s}input[type='range']{width:80%;height:10px;border:0;background-color:#f0f0f0;border-radius:5px;position:relative;-webkit-appearance:none !important;outline:0}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#f40}.file{position:relative;display:inline-block;background:#d0eeff;border:1px solid #99d3f5;border-radius:4px;padding:4px 12px;overflow:hidden;color:#1e88c7;text-decoration:none;text-indent:0;line-height:20px}.file input{position:absolute;font-size:100px;right:0;top:0;opacity:0}.file:hover{background:#aadffd;border-color:#78c3f3;color:#004974;text-decoration:none}a{color:#1e6bb8;text-decoration:none}a:hover{text-decoration:underline}.status{color:#fff;border-width:0;border-radius:3px;outline:0;font-size:17px;line-height:2.4rem;width:100%;}.status-success{background-color:#5cb85c;border-color:#4cae4c}.status-info{background-color:#5bc0de;border-color:#46b8da}.tab5{display:inline-block;color:#000000;min-width:340px;position:absolute;left:1%;margin-top:20px;width:99%}.tab5_text{resize:none;width:98%;height:600px;padding:5px;overflow:auto;background:#ffffff;color:#000000;}")
              + String("</style>")
              + String("<script type=\"text/javascript\">")
              + String("function id(d){return document.getElementById(d)}")
              + String("function tab(v){var divs=id('tab').children;var btns=id('nav').getElementsByTagName('button');for(var i=0;i<divs.length;i++){divs[i].style.display=divs[i]==id('tab'+v)?'block':'none';btns[i].setAttribute('class','')}id('tb'+v).setAttribute('class','active');}") // nav切换
              + String("function toast(a,b,c){var e;var m=id('alert');m.innerHTML=a;m.style.cssText=c?'color: #3c763d;background-color: #dff0d8;border-color: #d6e9c6;':'color: #a94442; background-color: #f2dede; border-color: #ebccd1;';m.style.display='block';clearTimeout(e);e=setTimeout(function(){var d=0.5;m.style.webkitTransition='-webkit-transform '+d+'s ease-in, opacity '+d+'s ease-in';m.style.opacity='0';setTimeout(function(){m.style.display='none'},d*1000)},b)}") // toast
              + String("function serialize(a){var b,s='';if(typeof a=='object'&&a.nodeName=='FORM'){for(var i=0;i<a.elements.length;i++){b=a.elements[i];if(b.name&&!b.disabled&&b.type!='file'&&b.type!='reset'&&b.type!='submit'&&b.type!='button'){if((b.type!='checkbox'&&b.type!='radio')||b.checked){s+=b.name+'='+encodeURIComponent(b.value)+'&'}}}}if(s.length>1){s=s.substring(0,s.length-1)}return s}")
              + String("function postform(the) {ajax({ type : 'POST', url : id(the).getAttribute('action'), data : serialize(id(the)), callback: function (x) {console.log(x);}, data_type: 'serialize' });return false;}")
              + String("function ajax({type,url,data,callback,data_type}){let xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){let res=xhr.responseText;callback(res)}};if (data_type!='serialize'){let arr=[];for(let key in data){arr.push(key+'='+data[key])}str=arr.join('&');}else{str = data}if(type==='GET'){xhr.open(type,url+'?'+str);xhr.send()}else if(type==='POST'){xhr.open(type,url);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(str)}}") // ajax
              + String("</script>")
              + String("<body><div id=\"body\"><div id=\"alert\" class=\"alert\"></div>")
              + String("<h1 style=\"text-align:center\">") + String(ACCESSORY_NAME) + String("</h1>")
              + String("<div id=\"nav\">")
              + String("<button id=\"tb1\" onclick=\"tab(1)\" class=\"active\">状态</button>")
              + String("<button id=\"tb2\" onclick=\"tab(2)\">联网</button>")
              + String("<button id=\"tb6\" onclick=\"tab(6)\">MQTT</button>")
              + String("<button id=\"tb3\" onclick=\"tab(3)\">控制</button>")
              + String("<button id=\"tb4\" onclick=\"tab(4)\">关于</button>")
              + String("<button id=\"tb5\" onclick=\"tab(5)\">日志</button>")
              + String("</div>")
              + String("<div id=\"tab\">")
              + String("<div id=\"tab1\" style=\"display: block;\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">设备状态</th></tr></thead><tbody><tr><td>主机名</td><td>") + String(WifiPrefix + String(ESP.getChipId())) + String("</td></tr> <tr><td>开机时间</td><td id='uptime'>0T00:00:13</td></tr> <tr><td>空闲内存</td><td><span id=\"free_mem\">") + String(ESP.getFreeSketchSpace() / 1024) + String("</span> kB</td></tr><tr><td>WiFi模式</td><td>AP STA</td></tr><tr><td>SSID</td><td></td></tr><tr><td>RSSI</td><td></td></tr><tr><td>IP地址</td><td>192.168.4.1</td></tr><tr><td>DHCP</td><td>DHCP</td></tr></tbody></table></div>")
              + String("<div id=\"tab2\"><form method=\"post\" action=\"/wifi\" onsubmit=\"return postform(this),!1\"><table class=\"gridtable\"><thead><tr><th>WiFi名称</th><th>信号</th></tr></thead><tbody><tr id=\"clusss\"><td>WiFi名称</td><td><input id=\"wifi_ssid\" name=\"wifi_ssid\"></td></tr><tr><td>WiFi密码</td><td><input name=\"wifi_password\"></td></tr><tr><td colspan=\"2\"><button type=\"submit\" class=\"btn-info\" onclick=\"alert('不打算开发');return;\">连接WiFi</button></td></tr><tr><td colspan=\"2\"><button type=\"button\" class=\"btn-danger\" onclick=\"alert('不打算开发');return;scanWifi()\">搜索WiFi</button></td></tr></tbody></table></form><script type=\"text/javascript\">function clickwifi(i){id(\"wifi_ssid\").value=i.value}function scanWifi(){ajaxPost(\"scan_wifi\",\"\",function(i){if(1==i.code){if(0==i.data.list.length)return void scanWifi();for(var e=document.getElementsByClassName(\"addwifi\"),t=e.length-1;t>=0;t--)e[t].remove();for(var a in i.data.list){var n=i.data.list[a],s=document.createElement(\"tr\"),l=document.createElement(\"td\");s.setAttribute(\"class\",\"addwifi\"),l.innerHTML=\"<label class='bui-radios-label'><input type='radio' name='wifi' onclick='clickwifi(this)' value='\"+n.name+\"'/><i class='bui-radios'></i> \"+n.name+(7==n.type?\" [开放]\":\"\")+\"</label>\",s.appendChild(l),l=document.createElement(\"td\"),l.innerHTML=n.rssi+\"dBm \"+n.quality+\"%\",s.appendChild(l);var c=id(\"clusss\");c.parentNode.insertBefore(s,c)}}else toast(i.msg,i.code?5e3:9e3,i.code)})}</script><form method=\"post\" action=\"/dhcp\" onsubmit=\"return postform(this),!1\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">WIFI高级设置</th></tr></thead><tbody><tr><td>高级</td><td><label class=\"bui-radios-label\"><input type=\"checkbox\" name=\"wifi_dis_restart\" value=\"1\"><i class=\"bui-radios\" style=\"border-radius:20%\"></i> 断开Wifi 10分钟自动重启</label></td></tr><tr><td>DHCP</td><td><label class=\"bui-radios-label\"><input type=\"radio\" name=\"dhcp\" value=\"1\" onchange=\"dhcponchange(this)\"><i class=\"bui-radios\"></i> DHCP</label>&nbsp;&nbsp;&nbsp;&nbsp;<label class=\"bui-radios-label\"><input type=\"radio\" name=\"dhcp\" value=\"2\" onchange=\"dhcponchange(this)\"><i class=\"bui-radios\"></i> 静态IP</label></td></tr><tr class=\"dhcp_hide\"><td>静态IP</td><td><input name=\"static_ip\"></td></tr><tr class=\"dhcp_hide\"><td>子网掩码</td><td><input name=\"static_netmask\"></td></tr><tr class=\"dhcp_hide\"><td>网关</td><td><input name=\"static_gateway\"></td></tr><tr><td colspan=\"2\"><button type=\"submit\" class=\"btn-info\" onclick=\"alert('不打算开发');return;\">保存</button></td></tr></tbody></table></form><script type=\"text/javascript\">function dhcponchange(e){for(var i=getRadioValue(\"dhcp\"),t=document.getElementsByClassName(\"dhcp_hide\"),n=0;n<t.length;n++)t[n].style.display=2==i?\"\":\"none\"}</script></div>")
              + String("<div id=\"tab6\"><form method=\"post\" action=\"/mqtt\" onsubmit=\"return postform(this),!1\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">MQTT设置</th></tr></thead><tbody><tr><td>地址</td><td><input name=\"mqtt_server\"></td></tr><tr><td>端口</td><td><input type=\"number\" min=\"0\" max=\"65535\" name=\"mqtt_port\" required value=\"0\">&nbsp;&nbsp;&nbsp;&nbsp;0为不启动mqtt</td></tr><tr><td>用户名</td><td><input name=\"mqtt_username\"></td></tr><tr><td>密码</td><td><input type=\"password\" name=\"mqtt_password\"></td></tr><tr><td>主题</td><td><input name=\"mqtt_topic\" value=\"%module%/%hostname%/%prefix%/\" style=\"min-width:90%\"></td></tr><tr><td>心跳上报间隔</td><td><input type=\"number\" min=\"0\" max=\"3600\" name=\"interval\" required value=\"5\">&nbsp;秒&nbsp;&nbsp;0为不上报</td></tr><tr><td>保留(Retain)</td><td><label class=\"bui-radios-label\"><input type=\"radio\" name=\"retain\" value=\"0\"><i class=\"bui-radios\"></i> 关闭</label>&nbsp;&nbsp;&nbsp;&nbsp;<label class=\"bui-radios-label\"><input type=\"radio\" name=\"retain\" value=\"1\"><i class=\"bui-radios\"></i> 开启</label><br>除非你知道它是干嘛的。</td></tr><tr><td>状态</td><td id=\"mqttconnected\">未连接 重连次数：-1</td></tr><tr><td colspan=\"2\"><button type=\"submit\" class=\"btn-info\" onclick=\"alert('不打算开发')\">保存</button></td></tr></tbody></table></form><form method=\"post\" action=\"/discovery\" onsubmit=\"return postform(this),!1\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">MQTT自动发现</th></tr></thead><tbody><tr><td>自发现状态</td><td id=\"discovery\">未启动</td></tr><tr><td>自发现前缀</td><td><input name=\"discovery_prefix\" required value=\"homeassistant\"></td></tr><tr><td colspan=\"2\"><button type=\"submit\" class=\"btn-info\" id=\"discovery_btn\" onclick=\"alert('不打算开发')\">打开MQTT自动发现</button></td></tr></tbody></table></form></div>")
              + String("<div id=\"tab3\">")
              + String("<table class=\"gridtable\"><thead><tr><th colspan=\"2\">传感器状态</th></tr></thead><tbody><tr style=\"text-align:center\"><td colspan=\"1\"><span style=\"font-weight: bold;\">雷达</span><div style=\"text-align: center;\" class=\"status-success status\" id=\"out_radar\">有人</div></td><td colspan=\"1\"><span style=\"font-weight: bold;\">红外</span><div style=\"text-align: center;\" class=\"status-success status\" id=\"out_infrared_ray\">有人</div></td></tr></tbody></table>")
              + String("<table class=\"gridtable\"><thead><tr><th colspan=\"2\">设置</th></tr></thead><tbody><form action=\"/saveconfig\" id=\"settings\"><tr><td>雷达有人射频</td><td><input type=\"text\" name=\"radar_exist\" placeholder=\"留空则不发射信号\" value=\"\"/></td></tr><tr><td>雷达无人射频</td><td><input type=\"text\" name=\"radar_not_exist\" placeholder=\"留空则不发射信号\" value=\"\"/></td></tr><tr><td>红外有人射频</td><td><input type=\"text\" name=\"infrared_ray_exist\" placeholder=\"留空则不发射信号\" value=\"\"/></td></tr><tr><td>红外无人射频</td><td><input type=\"text\" name=\"infrared_ray_not_exist\" placeholder=\"留空则不发射信号\" value=\"\"/></td></tr><tr><td>延时上报</td><td><input type=\"number\" min=\"1\" max=\"360\" name=\"delay_report\" required=\"\" value=\"5\"/> 秒</td></tr><tr><td>传感器位置</td><td><input type=\"text\" name=\"location\" value=\"\"/></td></tr><tr><td colspan=\"2\"><button type=\"button\" class=\"btn-info\" onclick=\"postform('settings');return false\">保存</button></form>")
              + String("<br/><button type=\"button\" class=\"btn-success\" style=\"margin-top:10px\" onclick=\"alert('暂未开发')\">下载HA配置文件</button></td></tr></tbody></table>")
              + String("<form method=\"post\" action=\"/module_setting\" onsubmit=\"postform(this);return false\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">模块设置</th></tr></thead><tbody><tr><td>主机名</td><td><input type=\"text\" name=\"uid\" value=\"") + String(WifiPrefix + String(ESP.getChipId())) + ("\" maxlength=\"15\" style=\"margin-right: 6px;\"/>具有唯一性，留空默认</td></tr><tr><td>日志输出</td><td><label class=\"bui-radios-label\" style=\"margin-right: 6px;\"><input type=\"checkbox\" name=\"log_serial\" value=\"1\"/><i class=\"bui-radios\" style=\"border-radius:20%; \"></i> Serial</label><label class=\"bui-radios-label\" style=\"margin-right: 6px;\"><input type=\"checkbox\" name=\"log_serial1\" value=\"1\"/><i class=\"bui-radios\" style=\"border-radius:20%;\"></i> Serial1</label><label class=\"bui-radios-label\"><input type=\"checkbox\" name=\"log_web\" value=\"1\"/><i class=\"bui-radios\" style=\"border-radius:20%;\"></i> Web</label></td></tr><tr><td colspan=\"2\"><button type=\"submit\" class=\"btn-info\" disabled=\"disabled\">设置</button></td></tr></tbody></table></form>")
              + String("<div><button type=\"button\" class=\"btn-danger\" style=\"margin-top: 10px\" onclick=\"javascript:if(confirm('确定要重启模块？')){ajax({ type:'POST', url:'/operate', data : {}, callback: function (x) {console.log(x);}, data_type: 'obj' });}\">重启模块</button><button type=\"button\" class=\"btn-danger\" style=\"margin-top: 10px\" onclick=\"javascript:if(confirm('确定要清除配置？')){ajax({ type:'POST', url:'/clearconfig', data : {}, callback: function (x) {console.log(x);toast(x, 5000, 1);},data_type:'obj' });}\">清除配置</button></div>")
              + String("</div>")

              + String("<div id=\"tab4\"><table class=\"gridtable\"><thead><tr><th colspan=\"2\">硬件参数</th></tr></thead><tbody>")
              + String("<tr><td>ESP芯片ID</td><td>") + String(ESP.getChipId()) + String("</td></tr>")
              + String("<tr><td>Flash芯片ID</td><td>" ) + String(ESP.getFlashChipId()) + String("</td></tr>")
              + String("<tr><td>Flash大小</td><td>") + String(ESP.getFlashChipRealSize() / 1024) + String(" kB</td></tr>")
              + String("<tr><td>固件Flash大小</td><td>") + String(ESP.getSketchSize() / 1024) + String(" kB</td></tr>")
              + String("<tr><td>固件大小</td><td>") + String(ESP.getSketchSize() / 1024) + String(" kB</td></tr>")
              + String("<tr><td>CPU运行频率</td><td>") + String(ESP.getCpuFreqMHz()) + String(" MHz</td></tr>")
              + String("<tr><td>空闲程序空间</td><td>") + String(ESP.getFreeSketchSpace() / 1024) + String(" kB</td></tr>")
              + String("<tr><td>内核和SDK版本</td><td>") + String(ESP.getCoreVersion()) + String(ESP.getSdkVersion()) + String("</td></tr>")
              + String("<tr><td>重启原因</td><td>") + String(ESP.getResetReason()) + String("</td></tr>")
              + String("<tr><td>MAC AP地址</td><td>") + String(MAC_CHAR_AP) + String("</td></tr>")
              + String("</tbody></table>")
              + String("<table class=\"gridtable\"><thead><tr><th colspan=\"2\">固件升级</th></tr></thead><tbody><tr><td>当前版本</td><td>") + String(ACCESSORY_SN) + String("</td></tr><tr><td>编译时间</td><td>") + String(compile_time) + String("</td></tr><form method='POST' action='/update' enctype='multipart/form-data'><tr><td colspan='2'><a class='file'><input type='file' name='file' />选择文件</a></td></tr><tr><td colspan='2'><button type='submit' class='btn-info'>升级</button></td></tr></form></tbody></table></div>")
              + String("<div id=\"tab5\"><div class=\"tab5\"><textarea readonly=\"\" id=\"log\" cols=\"340\" wrap=\"off\" class=\"tab5_text\">2022-07-16 21:27:41 read ...... ok</textarea></div></div>")
              + String("</div>")
              + String("<div style=\"text-align:center;margin-top:20px\">") + String(ACCESSORY_MANUFACTURER) + String("</div>")
              + String("</div></body>")
              + String("<script type=\"text/javascript\">")
              // + String("toast('连接成功', 5000, 1);toast('<strong>Oh snap!</strong> 请求出错！', 9000, false);") // test toast
              + String("ajax({type:'POST',url:'/readconfig',data:{},callback:function(x){var a=JSON.parse(x);document.getElementsByName('radar_exist').item(0).value=a.radar_exist;document.getElementsByName('radar_not_exist').item(0).value=a.radar_not_exist;document.getElementsByName('infrared_ray_exist').item(0).value=a.infrared_ray_exist;document.getElementsByName('infrared_ray_not_exist').item(0).value=a.infrared_ray_not_exist;document.getElementsByName('delay_report').item(0).value=a.delay_report;document.getElementsByName('location').item(0).value=a.location},data_type:'obj'});")
              + String("</script>")
              + String("</html>")
              ;
